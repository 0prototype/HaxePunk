<project name="HaxePunk" default="test" basedir=".">
	<description>Builds the haxepunk project</description>

	<target name="tools">
		<exec executable="haxe" dir="tools">
			<arg line="-main SetupTool" />
			<arg line="-neko ../run.n" />
		</exec>
	</target>

	<target name="haxelib" depends="tools">
		<zip destfile="template.zip" basedir="template" />
		<zip destfile="haxepunk.zip">
			<zipfileset dir="" prefix="haxepunk" includes="run.n,haxelib.xml,template.zip" />
			<zipfileset dir="src" prefix="haxepunk" />
			<zipfileset dir="tools" prefix="haxepunk/tools" includes="*.hx" />
		</zip>
		<exec executable="haxelib" dir=".">
			<arg line="test haxepunk.zip" />
		</exec>
	</target>

	<target name="test" depends="haxelib">
		<exec executable="haxelib" dir=".">
			<arg line="run HaxePunk new Test" />
		</exec>
		<exec executable="haxelib" dir="Test">
			<arg line="run nme build build.nmml flash -debug" />
		</exec>
	</target>

	<target name="deploy" depends="haxelib">
		<exec executable="haxelib" dir=".">
			<arg line="submit haxepunk.zip" />
		</exec>
	</target>

	<target name="doc" depends="haxelib">
		<exec executable="haxelib" dir=".">
			<arg line="run HaxePunk new Doc" />
		</exec>
		<exec executable="haxelib" dir="Doc" output="Doc/build.hxml">
			<arg line="run nme display build.nmml flash" />
		</exec>
		<exec executable="haxe" dir="Doc">
			<arg line="-xml haxedoc.xml" />
			<arg line="build.hxml" />
		</exec>
		<exec executable="chxdoc" dir="Doc">
			<arg line="haxedoc.xml" />
		</exec>
	</target>

	<target name="clean">
		<delete quiet="true">
			<fileset dir="Test" />
			<fileset dir="Doc" />
			<fileset dir="." includes="*.n,*.zip,com.haxepunk.debug.swf" />
		</delete>
	</target>

</project>